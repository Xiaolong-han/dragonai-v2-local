## 实施计划

### 一、后端修改

#### 1. 修改 `app/schemas/message.py`
- 在 `ChatRequest` 中添加 `enable_thinking: Optional[bool] = False` 参数

#### 2. 修改 `app/api/v1/chat.py`
- 在流式响应中传递 `enable_thinking` 参数到 `chat_service.generate_response_stream()`

#### 3. 修改 `app/services/chat_service.py`
- 修改 `generate_response_stream()` 方法，接收并传递 `enable_thinking` 参数
- 修改 `_format_stream_message()` 方法，处理深度思考内容的流式输出
- 添加新的事件类型 `thinking` 用于流式输出思考内容

### 二、前端修改

#### 1. 修改 `frontend/src/components/ChatInput.vue`
- 在工具栏左侧添加**模型选择按钮**（快速模型/专家模型切换）
- 在工具栏左侧添加**深度思考按钮**（开关切换）
- 通过 `emit` 向父组件传递 `isExpert` 和 `enableThinking` 状态

#### 2. 修改 `frontend/src/stores/chat.ts`
- 修改 `ChatMessage` 接口，添加 `thinking_content?: string` 字段
- 修改 `_sendMessageInternal()` 方法，传递 `is_expert` 和 `enable_thinking` 参数
- 修改 SSE 处理逻辑，支持接收和展示深度思考内容

#### 3. 修改 `frontend/src/components/ChatMessageBubble.vue`
- 添加深度思考内容展示区域
- 实现思考内容的折叠/展开功能
- 添加相应的样式

#### 4. 修改 `frontend/src/views/Chat.vue`
- 处理 `ChatInput` 组件传递的新参数

### 三、流式数据格式

深度思考内容的 SSE 数据格式：
```
data: {"type": "thinking", "content": "思考内容片段"}\n\n
data: {"type": "thinking_end"}\n\n
data: "正常回复内容"\n\n
```

### 四、UI 设计

- **模型选择按钮**：下拉选择，选项为「快速模型」和「专家模型」
- **深度思考按钮**：开关按钮，开启时高亮显示
- **思考内容展示**：灰色背景区域，默认折叠，点击可展开查看详细思考过程