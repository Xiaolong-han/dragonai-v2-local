## 目标
将工具执行统一由 Agent 管理，通过优化提示词格式让 Agent 自动识别工具意图。

## 改造方案

### 核心思路
前端在用户消息前添加工具标识前缀，如：
- 翻译：`"翻译：xxxxx"`
- 编程：`"编程：xxxxx"`
- 图像生成：`"生成图像：xxxxx"`
- 图像编辑：`"编辑图像：xxxxx"`

Agent 的 SYSTEM_PROMPT 已经包含工具说明，会自动识别并调用相应工具。

---

### 1. 后端改造

**1.1 修改 `app/api/v1/tools.py`**
- 删除直接触发API：`/translation`、`/coding`、`/image-generation`、`/image-editing`
- 保留元数据查询API：`GET /tools`、`GET /tools/{tool_name}`

**1.2 优化 `app/agents/agent_factory.py` 的 SYSTEM_PROMPT**
- 添加消息前缀识别规则说明
- 示例：`"翻译：Hello"` 应调用 `translate_text` 工具

---

### 2. 前端改造

**2.1 修改 `frontend/src/stores/chat.ts`**
- 删除 `_sendTranslationTool`、`_sendCodingTool`、`_sendImageGenerationTool`、`_sendImageEditingTool` 方法
- 修改 `sendMessageWithTool` 统一走 `_sendMessageInternal`，在消息前添加工具前缀

**2.2 删除 `frontend/src/stores/tool.ts`**
- 整个文件删除（直接调用API不再需要）

**2.3 修改专项工具页面**
- `Translation.vue`：改为调用 chatStore.sendMessageWithTool，消息格式 `"翻译：{text}"`
- `Coding.vue`：改为调用 chatStore.sendMessageWithTool，消息格式 `"编程：{prompt}"`
- `ImageGeneration.vue`：改为调用 chatStore.sendMessageWithTool，消息格式 `"生成图像：{prompt}"`
- `ImageEditing.vue`：改为调用 chatStore.sendMessageWithTool，消息格式 `"编辑图像：{prompt}"`

---

### 3. 消息格式示例

| 工具 | 前端发送消息 | 对话记录显示 |
|------|-------------|-------------|
| 翻译 | `"翻译：Hello world"` | `"翻译：Hello world"` |
| 编程 | `"编程：写一个排序算法"` | `"编程：写一个排序算法"` |
| 图像生成 | `"生成图像：一只可爱的猫"` | `"生成图像：一只可爱的猫"` |
| 图像编辑 | `"编辑图像：把背景改成蓝色"` | `"编辑图像：把背景改成蓝色"` |

---

### 4. 优点
1. 实现简单，无需修改后端 Schema
2. 用户消息直观，对话记录清晰
3. Agent 统一处理所有请求
4. 所有工具调用都支持流式输出