## 优化方案

在 `app/utils/` 下创建 `image_utils.py`，提取公共的图片处理逻辑：

### 1. 新建 `app/utils/image_utils.py`
```python
def resolve_image_source(image_source: str) -> tuple[str, bool]:
    """解析图片源，返回 (处理后的URL, 是否为Base64编码)
    
    支持：
    1. HTTP/HTTPS URL - 原样返回
    2. Base64 数据URI - 原样返回  
    3. 本地相对路径 - 通过 file_storage 解析并编码为 Base64
    4. 本地绝对路径 - 编码为 Base64
    """
```

### 2. 修改 `app/tools/multimodal_tool.py`
- 删除 `_build_image_content` 中的重复逻辑
- 调用 `resolve_image_source` 获取处理后的 URL
- 包装为 OpenAI 格式

### 3. 修改 `app/llm/qwen_models.py`
- 删除 `_prepare_image_content` 和 `_encode_local_file` 中的重复逻辑
- 调用 `resolve_image_source` 获取处理后的 URL
- 包装为阿里百炼格式